<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Assessments - Content Inventory</title>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Vue.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <!-- Font Awesome for icons (optional, but good for UI) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans antialiased">

    <div id="app" class="min-h-screen flex flex-col">

        <!-- Header -->
        <header class="bg-blue-800 text-white p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold">Assessment Services Branch</h1>
                <nav>
                    <ul class="flex space-x-4 items-center">
                        <li><a href="#" class="hover:text-blue-200">User Name</a></li>
                        <li><a href="#" class="bg-blue-700 hover:bg-blue-600 px-3 py-1 rounded-md">Logout</a></li>
                        <li>
                            <input type="text" placeholder="Global Search..." class="px-3 py-1 rounded-md text-gray-800 text-sm">
                        </li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Main Layout with Sidebar Navigation -->
        <div class="flex flex-1">
            <!-- Sidebar Navigation -->
            <aside class="w-64 bg-gray-800 text-white p-4 shadow-lg">
                <nav>
                    <ul>
                        <li class="mb-2">
                            <a href="my-assessments.html" class="block py-2 px-3 rounded-md bg-blue-700 hover:bg-blue-600 transition duration-200">My Assessments</a>
                        </li>
                        <li class="mb-2">
                            <a href="all-assessments.html" class="block py-2 px-3 rounded-md hover:bg-blue-700 transition duration-200">All Assessments <span class="text-xs text-gray-400">(Role-Based)</span></a>
                        </li>
                        <li class="mb-2">
                            <a href="reports.html" class="block py-2 px-3 rounded-md hover:bg-blue-700 transition duration-200">Reports</a>
                        </li>
                        <li class="mb-2">
                            <a href="admin.html" class="block py-2 px-3 rounded-md hover:bg-blue-700 transition duration-200">Administration <span class="text-xs text-gray-400">(Role-Based)</span></a>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="flex-1 p-8">
                <div class="container mx-auto">
                    <h2 class="text-3xl font-semibold text-gray-800 mb-6">My Assessments</h2>

                    <!-- Actions & Overview -->
                    <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
                        <button @click="createNewAssessment" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md flex items-center">
                            <i class="fas fa-plus mr-2"></i> Create New Assessment
                        </button>
                        <div class="flex space-x-4">
                            <!-- Summary Cards (Optional - FR-24) -->
                            <div class="bg-white p-3 rounded-lg shadow text-center">
                                <p class="text-sm text-gray-500">My Drafts</p>
                                <p class="text-xl font-bold text-blue-600">{{ summary.drafts }}</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg shadow text-center">
                                <p class="text-sm text-gray-500">In Review</p>
                                <p class="text-xl font-bold text-yellow-600">{{ summary.inReview }}</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg shadow text-center">
                                <p class="text-sm text-gray-500">Approved</p>
                                <p class="text-xl font-bold text-green-600">{{ summary.approved }}</p>
                            </div>
                            <div class="bg-white p-3 rounded-lg shadow text-center">
                                <p class="text-sm text-gray-500">Total</p>
                                <p class="text-xl font-bold text-gray-800">{{ summary.total }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Search and Filters (FR-22, FR-23) -->
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <div class="flex flex-wrap items-center gap-4 mb-4">
                            <div class="flex-grow">
                                <label for="keywordSearch" class="sr-only">Search my assessments...</label>
                                <input type="text" id="keywordSearch" v-model="filters.keyword" placeholder="Search my assessments by Process Name, Content, Location..."
                                    class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button @click="applyFilters" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md flex items-center">
                                <i class="fas fa-search mr-2"></i> Search
                            </button>
                            <button @click="toggleFilterPanel" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md flex items-center">
                                <i :class="{'fa-chevron-up': showFilters, 'fa-chevron-down': !showFilters}" class="fas mr-2"></i> {{ showFilters ? 'Hide Filters' : 'Show Filters' }}
                            </button>
                        </div>

                        <div v-if="showFilters" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 border-t pt-4 mt-4">
                            <div>
                                <label for="statusFilter" class="block text-sm font-medium text-gray-700">Status</label>
                                <select id="statusFilter" v-model="filters.status" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                    <option value="">All</option>
                                    <option value="Draft">Draft</option>
                                    <option value="In Review">In Review</option>
                                    <option value="Approved">Approved</option>
                                </select>
                            </div>
                            <div>
                                <label for="mediumFilter" class="block text-sm font-medium text-gray-700">Medium</label>
                                <select id="mediumFilter" v-model="filters.medium" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                    <option value="">All</option>
                                    <option v-for="option in referenceLists.medium" :key="option" :value="option">{{ option }}</option>
                                </select>
                            </div>
                            <div>
                                <label for="pibFilter" class="block text-sm font-medium text-gray-700">PIB Flag</label>
                                <select id="pibFilter" v-model="filters.pib" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                    <option value="">All</option>
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                            <div>
                                <label for="securityFilter" class="block text-sm font-medium text-gray-700">Security Classification</label>
                                <select id="securityFilter" v-model="filters.securityClassification" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                    <option value="">All</option>
                                    <option v-for="option in referenceLists.securityClassification" :key="option" :value="option">{{ option }}</option>
                                </select>
                            </div>
                            <div>
                                <label for="dispositionFilter" class="block text-sm font-medium text-gray-700">Final Disposition</label>
                                <select id="dispositionFilter" v-model="filters.finalDisposition" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                    <option value="">All</option>
                                    <option v-for="option in referenceLists.finalDisposition" :key="option" :value="option">{{ option }}</option>
                                </select>
                            </div>
                            <div>
                                <label for="fctFunctionFilter" class="block text-sm font-medium text-gray-700">FCT Function</label>
                                <select id="fctFunctionFilter" v-model="filters.fctFunction" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                    <option value="">All</option>
                                    <option v-for="option in referenceLists.fctFunction" :key="option" :value="option">{{ option }}</option>
                                </select>
                            </div>
                            <div>
                                <label for="fctActivityFilter" class="block text-sm font-medium text-gray-700">FCT Activity</label>
                                <select id="fctActivityFilter" v-model="filters.fctActivity" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                                    <option value="">All</option>
                                    <option v-for="option in referenceLists.fctActivity" :key="option" :value="option">{{ option }}</option>
                                </select>
                            </div>
                        </div>
                        <div v-if="showFilters" class="flex justify-end gap-2 mt-4 pt-4 border-t">
                            <button @click="clearFilters" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md">Clear Filters</button>
                            <button @click="applyFilters" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">Apply Filters</button>
                        </div>
                    </div>

                    <!-- Export and Import Options (FR-25, FR-26) -->
                    <div class="flex justify-end gap-4 mb-6">
                        <div class="relative inline-block text-left">
                            <button @click="showExportDropdown = !showExportDropdown" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md flex items-center">
                                <i class="fas fa-download mr-2"></i> Export
                                <i class="fas fa-caret-down ml-2"></i>
                            </button>
                            <div v-if="showExportDropdown" @click.away="showExportDropdown = false" class="origin-top-right absolute right-0 mt-2 w-40 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-10">
                                <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                                    <a href="#" @click.prevent="exportData('csv')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">CSV</a>
                                    <a href="#" @click.prevent="exportData('excel')" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Excel</a>
                                </div>
                            </div>
                        </div>
                        <button @click="showImportModal = true" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md flex items-center">
                            <i class="fas fa-upload mr-2"></i> Import Records
                        </button>
                    </div>

                    <!-- Assessment List / Table (FR-3, FR-11, FR-12, FR-14, FR-19, FR-27) -->
                    <div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th v-for="column in tableColumns" :key="column.key" @click="sortBy(column.key)"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer">
                                        {{ column.label }}
                                        <span v-if="sortKey === column.key">
                                            <i :class="{'fa-sort-up': sortDirection === 1, 'fa-sort-down': sortDirection === -1}" class="fas ml-1"></i>
                                        </span>
                                        <span v-else class="fas fa-sort ml-1 text-gray-300"></span>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr v-if="paginatedAssessments.length === 0">
                                    <td :colspan="tableColumns.length + 1" class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">
                                        No assessments found matching your criteria.
                                    </td>
                                </tr>
                                <tr v-for="assessment in paginatedAssessments" :key="assessment.id" class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        <a href="view-assessment.html" @click.prevent="viewAssessment(assessment.id)" class="text-blue-600 hover:text-blue-900">{{ assessment.processName }}</a>
                                    </td>
                                    <td class="px-6 py-4 text-sm text-gray-500 max-w-xs truncate">{{ assessment.content }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ assessment.informationController }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ assessment.medium }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ assessment.location }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ assessment.securityClassification }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <span :class="{'bg-green-100 text-green-800': assessment.pibIndicator === 'Yes', 'bg-red-100 text-red-800': assessment.pibIndicator === 'No'}"
                                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                                            {{ assessment.pibIndicator }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ assessment.fctFunction }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ assessment.fctActivity }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        <span :class="getStatusBadgeClass(assessment.status)"
                                            class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                                            {{ assessment.status }}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ assessment.lastUpdated }}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <div class="flex items-center space-x-2">
                                            <button @click="editAssessment(assessment.id)" :disabled="assessment.status === 'Approved'"
                                                :class="{'text-blue-600 hover:text-blue-900': assessment.status !== 'Approved', 'text-gray-400 cursor-not-allowed': assessment.status === 'Approved'}"
                                                class="inline-flex items-center p-1 rounded-full hover:bg-blue-100 disabled:bg-transparent">
                                                <i class="fas fa-edit"></i> <span class="sr-only">Edit</span>
                                            </button>
                                            <button @click="viewAssessment(assessment.id)"
                                                class="text-gray-600 hover:text-gray-900 inline-flex items-center p-1 rounded-full hover:bg-gray-100">
                                                <i class="fas fa-eye"></i> <span class="sr-only">View</span>
                                            </button>
                                            <button v-if="assessment.status === 'Draft'" @click="submitForReview(assessment.id)"
                                                :disabled="!isAssessmentComplete(assessment)"
                                                :class="{'text-green-600 hover:text-green-900': isAssessmentComplete(assessment), 'text-gray-400 cursor-not-allowed': !isAssessmentComplete(assessment)}"
                                                class="inline-flex items-center p-1 rounded-full hover:bg-green-100 disabled:bg-transparent">
                                                <i class="fas fa-paper-plane"></i> <span class="sr-only">Submit</span>
                                            </button>
                                            <button v-if="assessment.status === 'Draft'" @click="deleteAssessment(assessment.id)"
                                                class="text-red-600 hover:text-red-900 inline-flex items-center p-1 rounded-full hover:bg-red-100">
                                                <i class="fas fa-trash"></i> <span class="sr-only">Delete</span>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Pagination -->
                        <div class="flex justify-between items-center mt-6">
                            <span class="text-sm text-gray-700">
                                Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredAssessments.length) }} of {{ filteredAssessments.length }} entries
                            </span>
                            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                <button @click="prevPage" :disabled="currentPage === 1"
                                    class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span class="sr-only">Previous</span>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button v-for="page in totalPages" :key="page" @click="goToPage(page)"
                                    :class="{'bg-blue-600 text-white': page === currentPage, 'bg-white text-gray-700 hover:bg-gray-50': page !== currentPage}"
                                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium">
                                    {{ page }}
                                </button>
                                <button @click="nextPage" :disabled="currentPage === totalPages"
                                    class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span class="sr-only">Next</span>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </nav>
                        </div>
                    </div>

                    <!-- Import Records Modal -->
                    <div v-if="showImportModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex justify-center items-center z-50">
                        <div class="relative p-8 bg-white w-full max-w-lg mx-auto rounded-lg shadow-lg">
                            <h3 class="text-2xl font-bold mb-4">Import Content Inventory Records</h3>
                            <p class="mb-4 text-gray-700">Upload an Excel workbook containing your content inventory data. Ensure it follows the <a href="#" class="text-blue-600 hover:underline">standard template</a>.</p>

                            <div class="mb-4">
                                <label for="file-upload" class="flex items-center justify-center w-full px-4 py-6 border-2 border-dashed border-gray-300 rounded-md cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition duration-200">
                                    <span class="text-gray-600">
                                        <i class="fas fa-file-upload mr-2"></i> {{ fileName || 'Drag & drop your file here, or click to browse' }}
                                    </span>
                                    <input id="file-upload" type="file" class="hidden" @change="handleFileUpload">
                                </label>
                            </div>

                            <div v-if="importStatus" :class="{'bg-green-100 text-green-800': importStatus === 'success', 'bg-red-100 text-red-800': importStatus === 'error'}"
                                class="p-3 rounded-md mb-4">
                                <p v-if="importStatus === 'success'">{{ importMessage }}</p>
                                <ul v-else class="list-disc list-inside">
                                    <li v-for="(error, index) in importErrors" :key="index">{{ error }}</li>
                                </ul>
                            </div>

                            <div class="flex justify-end gap-2 mt-6">
                                <button @click="showImportModal = false" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">Cancel</button>
                                <button @click="performImport" :disabled="!selectedFile" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i v-if="importing" class="fas fa-spinner fa-spin mr-2"></i> Import
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-200 text-gray-700 p-4 text-center text-sm shadow-inner mt-auto">
            <div class="container mx-auto">
                &copy; 2024 Assessment Services Branch. All rights reserved. | Version 1.0.0
            </div>
        </footer>

    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                // Mock Data for demonstration
                assessments: [
                    {
                        id: 'a001', processName: 'HR Onboarding', content: 'Employee records, training materials', informationController: 'HR Department', medium: 'Electronic', location: 'SharePoint HR', securityClassification: 'Protected B', pibIndicator: 'Yes', fctFunction: 'Human Resources', fctActivity: 'Staffing', status: 'Draft', lastUpdated: '2024-01-15',
                        // Minimal required fields for 'isAssessmentComplete' demo
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                    {
                        id: 'a002', processName: 'Budget Planning', content: 'Financial forecasts, budget reports', informationController: 'Finance Department', medium: 'Electronic', location: 'ERP System', securityClassification: 'Protected A', pibIndicator: 'No', fctFunction: 'Financial Management', fctActivity: 'Budgeting', status: 'In Review', lastUpdated: '2024-02-01',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                    {
                        id: 'a003', processName: 'Client Intake', content: 'Client personal data, service requests', informationController: 'Client Services', medium: 'Electronic', location: 'CRM System', securityClassification: 'Protected C', pibIndicator: 'Yes', fctFunction: 'Client Service', fctActivity: 'Intake Management', status: 'Approved', lastUpdated: '2023-11-20',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                    {
                        id: 'a004', processName: 'Project Management', content: 'Project plans, status reports', informationController: 'PMO', medium: 'Electronic', location: 'Jira, Confluence', securityClassification: 'Unclassified', pibIndicator: 'No', fctFunction: 'Project Management', fctActivity: 'Planning', status: 'Draft', lastUpdated: '2024-02-10',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                    {
                        id: 'a005', processName: 'Records Disposition', content: 'Disposition schedules, transfer lists', informationController: 'Records Management', medium: 'Electronic', location: 'RM System', securityClassification: 'Protected B', pibIndicator: 'No', fctFunction: 'Information Management', fctActivity: 'Disposition', status: 'In Review', lastUpdated: '2024-01-25',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                     {
                        id: 'a006', processName: 'Vendor Contract Management', content: 'Contracts, invoices, vendor details', informationController: 'Procurement', medium: 'Electronic', location: 'Contract Management System', securityClassification: 'Protected A', pibIndicator: 'No', fctFunction: 'Procurement', fctActivity: 'Contracting', status: 'Draft', lastUpdated: '2024-02-12',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                    {
                        id: 'a007', processName: 'Policy Development', content: 'Policy drafts, consultation feedback', informationController: 'Policy Branch', medium: 'Electronic', location: 'SharePoint Policy', securityClassification: 'Unclassified', pibIndicator: 'No', fctFunction: 'Policy Management', fctActivity: 'Development', status: 'Approved', lastUpdated: '2023-10-01',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                    {
                        id: 'a008', processName: 'IT Asset Management', content: 'Hardware inventory, software licenses', informationController: 'IT Operations', medium: 'Electronic', location: 'Asset Management Tool', securityClassification: 'Protected A', pibIndicator: 'No', fctFunction: 'IT Management', fctActivity: 'Asset Tracking', status: 'Draft', lastUpdated: '2024-02-05',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                    {
                        id: 'a009', processName: 'Public Correspondence', content: 'Inquiries, responses, contact info', informationController: 'Communications', medium: 'Electronic', location: 'CRM/Email System', securityClassification: 'Unclassified', pibIndicator: 'Yes', fctFunction: 'Communications', fctActivity: 'Public Relations', status: 'In Review', lastUpdated: '2024-01-30',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                    {
                        id: 'a010', processName: 'Training Program Delivery', content: 'Course materials, participant lists', informationController: 'Learning & Development', medium: 'Electronic', location: 'LMS System', securityClassification: 'Protected B', pibIndicator: 'Yes', fctFunction: 'Human Resources', fctActivity: 'Training', status: 'Approved', lastUpdated: '2023-12-15',
                        processDescription: '...', approvedRetentionSchedules: '...', retentionTriggers: '...', retentionPeriods: '...', finalDispositions: '...'
                    },
                ],
                // Reference lists for filters (FR-6)
                referenceLists: {
                    medium: ['Electronic', 'Paper', 'Hybrid'],
                    securityClassification: ['Unclassified', 'Protected A', 'Protected B', 'Protected C'],
                    finalDisposition: ['Destroy', 'Transfer to Archives', 'Return to Originator'],
                    fctFunction: ['Human Resources', 'Financial Management', 'Client Service', 'Project Management', 'Information Management', 'Procurement', 'Policy Management', 'IT Management', 'Communications', 'Legal Services'],
                    fctActivity: ['Staffing', 'Budgeting', 'Intake Management', 'Planning', 'Disposition', 'Contracting', 'Development', 'Asset Tracking', 'Public Relations', 'Training', 'Litigation']
                },
                filters: {
                    keyword: '',
                    status: '',
                    medium: '',
                    pib: '',
                    securityClassification: '',
                    finalDisposition: '',
                    fctFunction: '',
                    fctActivity: ''
                },
                showFilters: false,
                sortKey: 'lastUpdated',
                sortDirection: -1, // 1 for ascending, -1 for descending
                currentPage: 1,
                itemsPerPage: 5,
                showExportDropdown: false,
                showImportModal: false,
                selectedFile: null,
                fileName: '',
                importing: false,
                importStatus: '', // 'success' or 'error'
                importMessage: '',
                importErrors: []
            },
            computed: {
                tableColumns() {
                    return [
                        { key: 'processName', label: 'Process Name' },
                        { key: 'content', label: 'Content' },
                        { key: 'informationController', label: 'Info Controller' },
                        { key: 'medium', label: 'Medium' },
                        { key: 'location', label: 'Location' },
                        { key: 'securityClassification', label: 'Security Class.' },
                        { key: 'pibIndicator', label: 'PIB' },
                        { key: 'fctFunction', label: 'FCT Function' },
                        { key: 'fctActivity', label: 'FCT Activity' },
                        { key: 'status', label: 'Status' },
                        { key: 'lastUpdated', label: 'Last Updated' },
                    ];
                },
                filteredAssessments() {
                    let filtered = this.assessments;

                    // Keyword search (FR-22)
                    if (this.filters.keyword) {
                        const searchLower = this.filters.keyword.toLowerCase();
                        filtered = filtered.filter(assessment =>
                            assessment.processName.toLowerCase().includes(searchLower) ||
                            assessment.processDescription.toLowerCase().includes(searchLower) ||
                            assessment.content.toLowerCase().includes(searchLower) ||
                            assessment.location.toLowerCase().includes(searchLower)
                        );
                    }

                    // Status filter (FR-23)
                    if (this.filters.status) {
                        filtered = filtered.filter(assessment => assessment.status === this.filters.status);
                    }

                    // Medium filter (FR-23)
                    if (this.filters.medium) {
                        filtered = filtered.filter(assessment => assessment.medium === this.filters.medium);
                    }

                    // PIB Flag filter (FR-13, FR-23)
                    if (this.filters.pib) {
                        filtered = filtered.filter(assessment => assessment.pibIndicator === this.filters.pib);
                    }

                    // Security Classification filter (FR-23)
                    if (this.filters.securityClassification) {
                        filtered = filtered.filter(assessment => assessment.securityClassification === this.filters.securityClassification);
                    }

                    // Final Disposition filter (FR-23)
                    if (this.filters.finalDisposition) {
                        filtered = filtered.filter(assessment => assessment.finalDisposition === this.filters.finalDisposition);
                    }

                    // FCT Function filter (FR-16, FR-23)
                    if (this.filters.fctFunction) {
                        filtered = filtered.filter(assessment => assessment.fctFunction === this.filters.fctFunction);
                    }

                    // FCT Activity filter (FR-16, FR-23)
                    if (this.filters.fctActivity) {
                        filtered = filtered.filter(assessment => assessment.fctActivity === this.filters.fctActivity);
                    }

                    // Sorting
                    if (this.sortKey) {
                        filtered.sort((a, b) => {
                            const valA = a[this.sortKey];
                            const valB = b[this.sortKey];

                            if (typeof valA === 'string' && typeof valB === 'string') {
                                return valA.localeCompare(valB) * this.sortDirection;
                            }
                            if (valA < valB) return -1 * this.sortDirection;
                            if (valA > valB) return 1 * this.sortDirection;
                            return 0;
                        });
                    }

                    return filtered;
                },
                summary() { // FR-24
                    const drafts = this.assessments.filter(a => a.status === 'Draft').length;
                    const inReview = this.assessments.filter(a => a.status === 'In Review').length;
                    const approved = this.assessments.filter(a => a.status === 'Approved').length;
                    const total = this.assessments.length;
                    return { drafts, inReview, approved, total };
                },
                totalPages() {
                    return Math.ceil(this.filteredAssessments.length / this.itemsPerPage);
                },
                paginatedAssessments() {
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    const end = start + this.itemsPerPage;
                    return this.filteredAssessments.slice(start, end);
                }
            },
            methods: {
                createNewAssessment() {
                    // In a real app, this would navigate to a form page or open a modal
                    alert('Navigating to Create New Assessment form...');
                    window.location.href = 'assessment-form.html'; // Placeholder for navigation
                },
                editAssessment(id) { // FR-2
                    // In a real app, this would navigate to an edit form with the assessment data
                    alert(`Editing assessment: ${id}`);
                    window.location.href = `assessment-form.html?id=${id}`; // Placeholder for navigation
                },
                viewAssessment(id) { // FR-2
                    // In a real app, this would navigate to a read-only view
                    alert(`Viewing assessment: ${id}`);
                    window.location.href = `view-assessment.html?id=${id}`; // Placeholder for navigation
                },
                submitForReview(id) { // FR-19
                    // Simulate submission
                    const assessment = this.assessments.find(a => a.id === id);
                    if (assessment && this.isAssessmentComplete(assessment)) {
                        assessment.status = 'In Review';
                        assessment.lastUpdated = new Date().toISOString().slice(0, 10);
                        alert(`Assessment ${id} submitted for review.`);
                    } else {
                        alert('Cannot submit. Mandatory fields are not complete.');
                    }
                },
                deleteAssessment(id) { // FR-21 (Draft records only)
                    if (confirm(`Are you sure you want to delete assessment ${id}? This action cannot be undone.`)) {
                        this.assessments = this.assessments.filter(a => a.id !== id);
                        alert(`Assessment ${id} deleted.`);
                    }
                },
                isAssessmentComplete(assessment) {
                    // FR-3: The system shall require at minimum: Process Name, Process Description, Content, Information Controller, Medium, and Location.
                    // FR-4: The system shall validate that Personal Information Bank (PIB) is explicitly set (Yes/No).
                    // This is a simplified check for the prototype. In a real app, this would be more robust.
                    return assessment.processName && assessment.processDescription && assessment.content &&
                           assessment.informationController && assessment.medium && assessment.location &&
                           (assessment.pibIndicator === 'Yes' || assessment.pibIndicator === 'No') &&
                           assessment.approvedRetentionSchedules && assessment.retentionTriggers &&
                           assessment.retentionPeriods && assessment.finalDispositions;
                },
                getStatusBadgeClass(status) {
                    switch (status) {
                        case 'Draft': return 'bg-gray-100 text-gray-800';
                        case 'In Review': return 'bg-yellow-100 text-yellow-800';
                        case 'Approved': return 'bg-green-100 text-green-800';
                        default: return 'bg-gray-100 text-gray-800';
                    }
                },
                toggleFilterPanel() {
                    this.showFilters = !this.showFilters;
                },
                applyFilters() {
                    this.currentPage = 1; // Reset to first page on filter change
                    // Filters are applied automatically by computed property `filteredAssessments`
                    alert('Filters applied!'); // For user feedback in prototype
                },
                clearFilters() {
                    this.filters = {
                        keyword: '', status: '', medium: '', pib: '',
                        securityClassification: '', finalDisposition: '',
                        fctFunction: '', fctActivity: ''
                    };
                    this.currentPage = 1; // Reset to first page
                    alert('Filters cleared!'); // For user feedback in prototype
                },
                sortBy(key) {
                    if (this.sortKey === key) {
                        this.sortDirection = this.sortDirection * -1;
                    } else {
                        this.sortKey = key;
                        this.sortDirection = 1; // Default to ascending for new sort key
                    }
                },
                prevPage() {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                    }
                },
                nextPage() {
                    if (this.currentPage < this.totalPages) {
                        this.currentPage++;
                    }
                },
                goToPage(page) {
                    this.currentPage = page;
                },
                exportData(format) { // FR-25
                    this.showExportDropdown = false;
                    alert(`Exporting current filtered data to ${format.toUpperCase()}... (simulated)`);
                    // In a real application, this would trigger an API call to generate and download the file.
                    // For prototype, we just simulate success.
                },
                handleFileUpload(event) { // FR-26
                    const file = event.target.files[0];
                    if (file) {
                        this.selectedFile = file;
                        this.fileName = file.name;
                        this.importStatus = '';
                        this.importMessage = '';
                        this.importErrors = [];
                    }
                },
                performImport() { // FR-26
                    if (!this.selectedFile) {
                        alert('Please select a file to import.');
                        return;
                    }

                    this.importing = true;
                    this.importStatus = '';
                    this.importMessage = '';
                    this.importErrors = [];

                    // Simulate API call and validation
                    setTimeout(() => {
                        const isSuccess = Math.random() > 0.3; // Simulate success/failure
                        if (isSuccess) {
                            this.importStatus = 'success';
                            this.importMessage = `Successfully imported "${this.fileName}". 5 new records added, 2 updated.`;
                            // In a real app, you'd refresh the assessments list here.
                        } else {
                            this.importStatus = 'error';
                            this.importErrors = [
                                `Error in row 3: Missing 'Process Name'.`,
                                `Error in row 7: Invalid 'Security Classification' value.`,
                                `Import of "${this.fileName}" failed for some records.`
                            ];
                        }
                        this.importing = false;
                        this.selectedFile = null;
                        this.fileName = '';
                    }, 2000); // Simulate network delay
                }
            }
        });
    </script>
</body>
</html>